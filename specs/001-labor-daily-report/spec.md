# Feature Specification: ระบบจัดการแรงงานและรายงานประจำวัน

**Feature Branch**: `001-labor-daily-report`
**Created**: 2025-10-22
**Status**: Draft
**Input**: User description: "ระบบคำนวณค่าแรงงาน และการลง DailyReport แรงงาน โดยมี Navbar สำหรับนำทางไปหน้าต่างๆ ประกอบด้วย Dashboard แสดงสรุปแรงงาน, New Project, Member Management, DC Management และหน้าลงข้อมูล DailyReport พร้อม OT"

## Execution Status

| User Story | Priority | Status | Progress | Notes |
|------------|----------|--------|----------|-------|
| US1 - Dashboard และ Navigation | P1 | Not Started | 0% | MVP - ต้องทำก่อน |
| US2 - Daily Report (เวลาปกติ) | P2 | Not Started | 0% | Core functionality |
| US3 - Overtime (OT) | P3 | Not Started | 0% | ต่อจาก US2 |
| US4 - Project Management | P4 | Not Started | 0% | Admin feature |
| US5 - Member Management | P5 | Not Started | 0% | Admin feature |
| US6 - DC Management | P6 | Not Started | 0% | Master data |
| US7 - Wage Calculation | P7 | Not Started | 0% | Complex calculation |
| US8 - ScanData Management & Monitoring | P8 | Not Started | 0% | Validation & monitoring |

**Status Legend:**
- **Not Started**: ยังไม่เริ่มพัฒนา
- **In Progress**: กำลังพัฒนา
- **In Review**: รอ review code
- **Testing**: กำลังทดสอบ
- **Completed**: เสร็จสมบูรณ์
- **Blocked**: มีปัญหาขัดขวาง

**Recommended Implementation Order:**
1. US1 (P1) → US2 (P2) → US3 (P3) - Core MVP สำหรับบันทึก Daily Report
2. US4 (P4) → US5 (P5) → US6 (P6) - Master data management
3. US7 (P7) - Wage calculation (ต้องมี US2, US3, US6 เสร็จก่อน)
4. US8 (P8) - ScanData monitoring (ต้องมี US2, US3, US7 เสร็จก่อน)

## User Scenarios & Testing *(mandatory)*

### User Story 1 - การดูสรุปแรงงานและสถานะปัจจุบัน (Priority: P1)

ในฐานะผู้บริหารโครงการ ฉันต้องการเห็นภาพรวมของแรงงานทั้งหมดในระบบ และจำนวนแรงงานที่ Active อยู่ในปัจจุบัน เพื่อที่จะสามารถติดตามสถานะและวางแผนการใช้แรงงานได้อย่างมีประสิทธิภาพ

**Why this priority**: นี่คือหน้าหลักของระบบที่ให้ภาพรวมสำคัญที่สุด ผู้ใช้ต้องการเห็นข้อมูลสรุปก่อนที่จะดำเนินการอื่นๆ ทำให้เป็น MVP แรกที่ต้องมี

**Independent Test**: สามารถทดสอบได้โดยเข้าสู่ระบบและตรวจสอบว่า Dashboard แสดงจำนวนแรงงาน Active ทั้งหมดอย่างถูกต้อง และมี Navigation Menu ที่สามารถคลิกไปยังหน้าอื่นๆ ได้

**Acceptance Scenarios**:

1. **Given** ผู้ใช้เข้าสู่ระบบสำเร็จ, **When** หน้า Dashboard โหลดเสร็จ, **Then** ระบบแสดงจำนวนแรงงาน Active ทั้งหมดในปัจจุบัน
2. **Given** ผู้ใช้อยู่ที่หน้า Dashboard, **When** ดูที่ Navbar, **Then** เห็นเมนู New Project, Member Management, DC Management, Daily Report และ Wage Calculation
3. **Given** ผู้ใช้อยู่ที่หน้า Dashboard, **When** คลิกที่เมนูใดเมนูหนึ่งใน Navbar, **Then** ระบบนำทางไปยังหน้าที่เลือกได้สำเร็จ

---

### User Story 2 - การบันทึก Daily Report แรงงานในเวลาปกติ (Priority: P2)

ในฐานะ Foreman หรือ Site Engineer ฉันต้องการบันทึกรายงานการทำงานประจำวันของแรงงาน โดยระบุโครงการ, รายชื่อแรงงาน, งานที่ทำ, วันที่ และเวลาทำงาน เพื่อใช้ในการคำนวณค่าแรงและติดตามความคืบหน้าของงาน

**Why this priority**: เป็นฟังก์ชันหลักของระบบที่ใช้บันทึกข้อมูลประจำวัน ซึ่งเป็นพื้นฐานสำหรับการคำนวณค่าแรงและการรายงาน

**Independent Test**: สามารถทดสอบได้โดยเข้าหน้า Daily Report, เลือกโครงการ, เลือกแรงงาน (single/multiple), กรอกงานที่ทำ, วันที่ และช่วงเวลา จากนั้นบันทึกข้อมูลและตรวจสอบว่าข้อมูลถูกบันทึกถูกต้อง

**Acceptance Scenarios**:

1. **Given** ผู้ใช้เข้าหน้า Daily Report, **When** เลือกโครงการจาก dropdown (ค่าเริ่มต้นคือโครงการที่ User นั้นสังกัดใน Database), **Then** ระบบแสดงรายชื่อแรงงานรายวัน (DC) ที่อยู่ในโครงการนั้นใน Auto Complete field
2. **Given** ผู้ใช้เห็นรายชื่อ DC, **When** เลือกแรงงานหลายคน (Multi Select), **Then** ระบบเก็บรายชื่อที่เลือกไว้ทั้งหมดเพื่อบันทึกเวลาทำงานจริง ที่ทำงานอะไร เวลาเริ่ม เวลาจบ และแยกชั่วโมงงานปกติ ชั่วโมงโอทีเช้า โอทีเที่ยง โอทีเย็น และสามารถแยกงานหลัก กรณีที่ทำงานช่วงเช้างานหนึ่ง งานบ่ายอีกงานหนึ่ง ตัว Field จะเหมือนกัน หรืออาจจะเพิ่ม Field ให้ User เลือก : เวลาปกติ, โอทีเช้า, โอทีเที่ยง, โอทีเย็น
3. **Given** ผู้ใช้กรอกข้อมูลครบถ้วน (Project, DC List, Task Name, Date, Start Time, End Time), **When** กดบันทึก, **Then** ระบบบันทึกรายงานการทำงานเวลาปกติสำเร็จ และเวลาที่เลือกแต่ละช่วงต้องไม่ซ้อนทับกัน ทางที่ดี ควรแสดงเฉพาะเวลาที่ยังไม่เลือก เช่น เลือก 8:00 - 12:00 ก็ให้แสดงให้เลือกตอนเริ่ม 12:00 - 24:00 น. เพื่อป้องกันการเลือกซ้ำ
4. **Given** ผู้ใช้ต้องการบันทึกงานครึ่งวันเช้าและบ่าย, **When** เพิ่มชุดข้อมูลที่ 2 ด้วยงานและเวลาที่แตกต่างกัน, **Then** ระบบบันทึกทั้ง 2 ชุดข้อมูลแยกกัน รวมถึงโอทีด้วย แยกออกจากกันเป็นอีกชุดข้อมูลใน Database
5. **Given** ผู้ใช้เปิดหน้า Daily Report, **When** ดูที่ field Date, **Then** ระบบตั้งค่า default เป็นวันที่ปัจจุบันเสมอ และหากมีตัวเลือกโครงการให้เลือกโครงการที่ User สังกดอยู่
6. **Given** ผู้ใช้เปิดหน้า Daily Report, **When** ดูที่ field Project, **Then** ระบบตั้งค่า default เป็น Project Location ล่าสุดจากฐานข้อมูล

---

### User Story 3 - การบันทึก Overtime (OT) (Priority: P3)

ในฐานะ Foreman หรือ Site Engineer ฉันต้องการบันทึก Overtime ของแรงงาน โดยแบ่งเป็น OT เช้า, OT กลางวัน และ OT เย็น เพื่อคำนวณค่าแรง OT ได้ถูกต้องตามช่วงเวลา

**Why this priority**: เป็นส่วนเสริมจากการบันทึกเวลาปกติ ช่วยให้คำนวณค่าแรงได้ครบถ้วนมากขึ้น แต่ไม่ใช่ฟังก์ชันที่จำเป็นต้องมีตั้งแต่แรก

**Independent Test**: สามารถทดสอบได้โดยคลิกที่ tab Overtime ในหน้า Daily Report จากนั้นกรอกข้อมูล OT เช้า, กลางวัน หรือเย็น (fields เหมือนกับเวลาปกติ) และตรวจสอบว่าระบบบันทึกข้อมูล OT แยกต่างหากจากเวลาปกติ

**Acceptance Scenarios**:

1. **Given** ผู้ใช้อยู่ที่หน้า Daily Report, **When** คลิกที่ tab "Overtime", **Then** ระบบแสดงฟอร์มสำหรับบันทึก OT
2. **Given** ผู้ใช้อยู่ที่ tab Overtime, **When** เลือกช่วง OT เช้า, **Then** ระบบแสดง fields: Project, DC List, Task Name, Date, Start Time, End Time สำหรับ OT เช้า
3. **Given** ผู้ใช้กรอกข้อมูล OT เช้า, **When** เลือกเพิ่มข้อมูล OT กลางวัน, **Then** ระบบแสดงชุดข้อมูลที่ 2 สำหรับ OT กลางวัน
4. **Given** ผู้ใช้กรอกข้อมูล OT เช้าและกลางวัน, **When** เลือกเพิ่มข้อมูล OT เย็น, **Then** ระบบแสดงชุดข้อมูลที่ 3 สำหรับ OT เย็น
5. **Given** ผู้ใช้กรอกข้อมูล OT ครบถ้วน, **When** กดบันทึก, **Then** ระบบบันทึกข้อมูล OT แยกจากเวลาปกติ และระบุช่วงเวลา OT (เช้า/กลางวัน/เย็น) ไว้ด้วย

---

### User Story 4 - การจัดการโครงการ (New Project) (Priority: P4)

ในฐานะ Admin, OE, PE, PM or PD ฉันต้องการเพิ่มโครงการ (Project Location) ใหม่เข้าสู่ระบบ เพื่อให้แรงงานสามารถเลือกทำงานที่โครงการนั้นๆ และบันทึก Daily Report ได้

**Why this priority**: เป็นฟังก์ชัน Admin ที่จำเป็นแต่ไม่ต้องใช้บ่อย สามารถทำได้ทีหลังหลังจาก core functionality (Dashboard และ Daily Report) เสร็จแล้ว

**Independent Test**: สามารถทดสอบได้โดยเข้าเมนู New Project, กรอกข้อมูลโครงการใหม่ (ชื่อ, รหัสโครงการ, สังกัด([PD01, PD02, PD03, PD04, PD05])) บันทึก และตรวจสอบว่าโครงการใหม่ปรากฏใน dropdown ของหน้า Daily Report

**Acceptance Scenarios**:

1. **Given** ผู้ใช้ที่มีสิทธิ์ (Admin, OE, PE, PM or PD) คลิกเมนู New Project, **When** หน้าเพิ่มโครงการโหลดเสร็จ, **Then** ระบบแสดงฟอร์มสำหรับกรอกข้อมูลโครงการใหม่
2. **Given** ผู้ใช้กรอกข้อมูลโครงการใหม่ครบถ้วน, **When** กดบันทึก, **Then** ระบบบันทึกโครงการใหม่เข้าฐานข้อมูล
3. **Given** โครงการใหม่ถูกบันทึกแล้ว, **When** ผู้ใช้เข้าหน้า Daily Report และเปิด dropdown Project, **Then** โครงการใหม่ปรากฏในรายการให้เลือก ในรูปแบบดังตั้วอย่างนี้ "สังกัด_ชื่อโครงการ" เช่น "PD01_Project01"

---

### User Story 5 - การจัดการสมาชิก (Member Management) (Priority: P5)

ในฐานะ Admin ฉันต้องการจัดการข้อมูลผู้ใช้ในระบบ (User) รวมถึงการกำหนดสิทธิ์การเข้าถึง Project Location,สังกัด ([PD01, PD02, PD03, PD04, PD05]), Employee ID, Username, Password, Name, Role (Admin(AM)/Foreman(FM)/Site Eng.(SE)/Office Eng.(OE)/Project Manager(PM)/Project Director(PD)/Managing Director), วันเกิด ,วันที่เริ่มงาน เพื่อควบคุมการเข้าถึงระบบและข้อมูลต่างๆ

**Why this priority**: เป็นฟังก์ชัน User Management ที่สำคัญแต่สามารถทำได้ทีหลังหลังจาก core features เสร็จ เนื่องจากในระยะ MVP อาจมีผู้ใช้จำนวนจำกัด

**Independent Test**: สามารถทดสอบได้โดยเข้าเมนู Member Management, เพิ่ม/แก้ไข/ลบข้อมูลผู้ใช้, กำหนดสิทธิ์และ Role จากนั้นตรวจสอบว่าผู้ใช้สามารถเข้าถึงข้อมูลตามสิทธิ์ที่กำหนดได้

**Acceptance Scenarios**:

1. **Given** Admin เข้าเมนู Member Management, **When** คลิกเพิ่มสมาชิกใหม่, **Then** ระบบแสดงฟอร์มกรอกข้อมูล: Employee ID, Username, Password, Name, Role, วันเกิด, วันที่เริ่มงาน
2. **Given** Admin กรอกข้อมูลสมาชิกใหม่ครบถ้วน, **When** เลือก Role , **Then** ระบบเก็บ Role ไว้สำหรับการควบคุมสิทธิ์
3. **Given** Admin กรอกข้อมูลสมาชิกใหม่ครบถ้วน, **When** กำหนดสิทธิ์การเข้าถึง Project Location, **Then** ระบบเก็บสิทธิ์การเข้าถึงโครงการต่างๆ ไว้ โดยหาก Position PD จะเข้าถึงโครงการที่อยู่ในสังกัด PD เดียวกัน และถ้าเป็น MD เห็นทุกโครงการ
4. **Given** Admin เห็นรายชื่อสมาชิกทั้งหมด, **When** เลือกแก้ไขข้อมูลสมาชิก, **Then** ระบบแสดงข้อมูลปัจจุบันและอนุญาตให้แก้ไข
5. **Given** Admin เห็นรายชื่อสมาชิกทั้งหมด, **When** เลือกลบสมาชิก, **Then** ระบบลบข้อมูลสมาชิกและปิดการเข้าถึงระบบของสมาชิกนั้น

---

### User Story 6 - การจัดการแรงงานรายวัน (DC Management) (Priority: P6)

ในฐานะ Admin หรือ Foreman ฉันต้องการจัดการข้อมูลแรงงานรายวัน (DC - Daily Contractor) โดยเพิ่ม/ลบ/แก้ไข/จัดการค่าแรง ข้อมูล: Employee ID, Username, Password, Name,Position, Skill เพื่อให้สามารถเลือกแรงงานเหล่านี้ในการบันทึก Daily Report รวมถึงการกรอกข้อมูลสวัสดิการณ์ หรือเงื่อนไขค่าแรงต่าง ๆ จากการกดปุ่ม"จัดการค่าแรง" 

**Why this priority**: เป็นฟังก์ชัน Master Data Management สำหรับแรงงานรายวัน จำเป็นแต่สามารถทำได้ทีหลัง เนื่องจากในระยะ MVP อาจ import ข้อมูลจากที่อื่นได้

**Independent Test**: สามารถทดสอบได้โดยเข้าเมนู DC Management, เพิ่ม/แก้ไข/ลบข้อมูลแรงงานรายวัน จากนั้นตรวจสอบว่าแรงงานที่เพิ่มปรากฏใน Auto Complete ของหน้า Daily Report

**Acceptance Scenarios**:

1. **Given** ผู้ใช้ที่มีสิทธิ์เข้าเมนู DC Management, **When** คลิกเพิ่มแรงงานรายวันใหม่, **Then** ระบบแสดงฟอร์มกรอกข้อมูล: Employee ID, Username, Password, Name, Skill
2. **Given** ผู้ใช้กรอกข้อมูลแรงงานรายวันครบถ้วน, **When** กดบันทึก, **Then** ระบบบันทึกข้อมูลแรงงานรายวันเข้าฐานข้อมูล
3. **Given** แรงงานรายวันถูกบันทึกแล้ว, **When** ผู้ใช้เข้าหน้า Daily Report และเลือกโครงการ, **Then** แรงงานรายวันนั้นปรากฏใน Auto Complete field DC List
4. **Given** ผู้ใช้เห็นรายชื่อแรงงานรายวันทั้งหมด, **When** เลือกแก้ไขข้อมูล, **Then** ระบบแสดงข้อมูลปัจจุบันและอนุญาตให้แก้ไข
5. **Given** ผู้ใช้เห็นรายชื่อแรงงานรายวันทั้งหมด, **When** เลือกลบแรงงานรายวัน, **Then** ระบบลบข้อมูลและแรงงานรายวันนั้นไม่ปรากฏใน Daily Report อีก
6. **Given** ผู้ใช้เห็นรายชื่อแรงงานรายวันทั้งหมด, **When** เลือกจัดการค่าแรง, **Then** ระบบแสดงPopup แบ่งเป็น 2ส่วน ส่วนที่ 1 สำหรับกรอกข้อมูลข้อมูลแรงงานด้านรายได้ : ค่าแรงต่อชั่วโมง, ค่าแรงOTต่อชั่วโมง (คำนวณอัตโนมัตจากค่าแรงปกติ * 1.5), ค่าวิชาชีพต่อชั่วโมง และ ค่าโทรศัพธ์ต่องวด  ส่วนที่ 2 สำหรับกรอกข้อมูลข้อมูลแรงงานด้านรายจ่าย : ค่าที่พักต่องวด, จำนวนผู้ติดตาม, ค่าที่พักผู้ติดตามต่องวด (คำนวณอัตโนมัติ จำนวนผู้ติดตาม * 300), ค่าใช้ตู้เย็นต่องวด, ค่าใช้เครื่องเสียงต่องวด, ค่าใช้ทีวีต่องวด, ค่าใช้เครื่องซักผ้าต่องวด และ ค่าใช้แอร์เคลื่อนที่ต่องวด

---

### User Story 7 - การคำนวณค่าแรงต่องวด (WageCaculation) (Priority: P7)

ในฐานะ Admin ฉันต้องการจัดเห็นสรุปการคำนวณค่าแรงที่ต้องจ่ายในแต่ละงวดโดย 1 งวดจะอยู่ในช่วง 15 วันเพื่อทำจ่ายให้กับ (DC - Daily Contractor) โดยสามารถ สร้างงวดตัดค่าแรง/แก้ไข/ลบ ได้ โดยภายในการสร้างงวดค่าแรงจะทำงานเพื่อกำหนดขอบเขตุการคำนวณ และให้ได้ผลลัพธ์ที่ User ต้องการ

**Why this priority**: เป็นฟังก์ชัน Master Data Management และ Calculate สำหรับคำนวณค่าแรงงานรายวัน จำเป็นและต้องทำอันดับแรก ๆ 

**Independent Test**: สามารถทดสอบได้โดยเข้าเมนู "WageCaculation", เพิ่ม/แก้ไข/ลบข้อมูลงวดตัดค่าแรงจากนั้นคำนวณพร้อมสรุป Export ออกมาเป็น Excel โดยประกอบด้วย Field : ลำดับ (runningNumber), EmployeeID, EmployeeName, Position, Skill, วันที่เริ่มต้นงวด, วันที่สิ้นสุดงวด, จำนวนชั่วโมงปกติรวมทั้งงวด, จำนวนชั่วโมงโอทีรวมทั้งงวด, ค่าแรงต่อชั่วโมง, ค่าวิชาชีพต่อชั่วโมง, ยอดรายได้อื่น ๆ ประจำงวด, ค่าโทรศัพธ์ต่องวด, ยอดรวมค่าแรงปกติ (จำนวนชั่วโมงปกติรวมทั้งงวด * ค่าแรงต่อชั่วโมง), ยอดรวมค่าแรงโอที (จำนวนชั่วโมงโอทีรวมทั้งงวด * ค่าแรงต่อชั่วโมง*1.5),ยอดรวมค่าวิชาชีพ (จำนวนชั่วโมงปกติรวมทั้งงวด * ค่าวิชาชีพต่อชั่วโมง), ค่าที่พักต่องวด, ค่าที่พักผู้ติดตามต่องวด, ค่าใช้ตู้เย็นต่องวด, ค่าใช้เครื่องเสียงต่องวด, ค่าใช้ทีวีต่องวด, ค่าใช้เครื่องซักผ้าต่องวด, ค่าใช้แอร์เคลื่อนที่ต่องวด, รายจ่ายอื่น ๆ ประจำงวด, ยอดประกันสังที่ควรจ่าย (คำนวณจาก ยอดรวมค่าแรงปกติ * 0.05), ยอดจ่ายประกันสังคมที่ชำระแล้วในเดือน (ยอดรวมค่าแรงปกติในเดือนเดียวกันกับวันเริ่มงวด * 0.05), ยอดจ่ายประกันสังคมประจำงวด (หากEmployeeID ขึ้นต้นด้วยเลข 9 เช่น 900001 ให้คืนค่า 0 แต่ถ้า if(ยอดประกันสังที่ควรจ่าย + ยอดจ่ายประกันสังคมที่ชำระแล้วในเดือน > 750 บาท, 750 - ยอดจ่ายประกันสังคมที่ชำระแล้วในเดือน , if(ยอดประกันสังที่ควรจ่าย > 83,ยอดประกันสังที่ควรจ่าย,83)), ยอดรวมรายได้ (คำนวณจากรายได้รวมทั้งหมด), ยอดรวมรายจ่าย (คำนวณจากรายจ่ายรวมทั้งหมด), ยอดสุทธิ (ยอดรวมรายได้ - ยอดรวมรายจ่าย)และหมายเหตุ 

**Acceptance Scenarios**:

1. **Given** ผู้ใช้ที่มีสิทธิ์เข้าเมนู WageCalculation, **When** คลิกเพิ่มงวดตัดค่าแรง, **Then** ระบบแสดง Popup ฟอร์มกรอกข้อมูล: วันที่เริ่มต้นงวด, วันที่สิ้นสุดงวด, โครงการ (ค่าตั้งต้น ตามสังกัดที่อยู่)
2. **Given** ผู้ใช้กรอกข้อมูลครบถ้วน, **When** กดเริ่มคำนวณ, **Then** ระบบทำการดึงข้อมูลจากฐานข้อมูลที่เกี่ยวข้องกับ ข้อมูล DC พวกรายละเอียดรายได้ และค่าใช้จ่ายแต่ละคน และ Daily Report ต่าง ๆ ที่อยู่ในช่วง วันที่เริ่มต้นและสิ้นสุดงวดและเห็นปุ่มในการเพิ่ม "รายจ่ายอื่น ๆ ประจำงวด" และ "ยอดรายได้อื่น ๆ ประจำงวด" คำนวณดังต่อไปนี้
      ลำดับ (runningNumber), EmployeeID, EmployeeName, Position, Skill, วันที่เริ่มต้นงวด, วันที่สิ้นสุดงวด, จำนวนชั่วโมงปกติรวมทั้งงวด, จำนวนชั่วโมงโอทีรวมทั้งงวด, ค่าแรงต่อชั่วโมง, ค่าวิชาชีพต่อชั่วโมง, ยอดรายได้อื่น ๆ ประจำงวด, ค่าโทรศัพธ์ต่องวด, ยอดรวมค่าแรงปกติ (จำนวนชั่วโมงปกติรวมทั้งงวด * ค่าแรงต่อชั่วโมง), ยอดรวมค่าแรงโอที (จำนวนชั่วโมงโอทีรวมทั้งงวด * ค่าแรงต่อชั่วโมง*1.5),ยอดรวมค่าวิชาชีพ (จำนวนชั่วโมงปกติรวมทั้งงวด * ค่าวิชาชีพต่อชั่วโมง), ค่าที่พักต่องวด, ค่าที่พักผู้ติดตามต่องวด, ค่าใช้ตู้เย็นต่องวด, ค่าใช้เครื่องเสียงต่องวด, ค่าใช้ทีวีต่องวด, ค่าใช้เครื่องซักผ้าต่องวด, ค่าใช้แอร์เคลื่อนที่ต่องวด, รายจ่ายอื่น ๆ ประจำงวด, ยอดประกันสังที่ควรจ่าย (คำนวณจาก ยอดรวมค่าแรงปกติ * 0.05), ยอดจ่ายประกันสังคมที่ชำระแล้วในเดือน (ยอดรวมค่าแรงปกติในเดือนเดียวกันกับวันเริ่มงวด * 0.05), ยอดจ่ายประกันสังคมประจำงวด (หากEmployeeID ขึ้นต้นด้วยเลข 9 เช่น 900001 ให้คืนค่า 0 แต่ถ้า if(ยอดประกันสังที่ควรจ่าย + ยอดจ่ายประกันสังคมที่ชำระแล้วในเดือน > 750 บาท, 750 - ยอดจ่ายประกันสังคมที่ชำระแล้วในเดือน , if(ยอดประกันสังที่ควรจ่าย > 83,ยอดประกันสังที่ควรจ่าย,83) ), ยอดรวมรายได้ (คำนวณจากรายได้รวมทั้งหมด), ยอดรวมรายจ่าย (คำนวณจากรายจ่ายรวมทั้งหมด), ยอดสุทธิ (ยอดรวมรายได้ - ยอดรวมรายจ่าย)และหมายเหตุ 
3. **Given** ผู้ใช้งานกรอกข้อมูล รายได้อื่น ๆ ประจำงวด, **When** ผู้ใช้เข้าหน้า WageCalculation และหลังจากกดปุ่มคำนวณ ที่รายชื่อแต่ละคนกดที่ปุ่ม "รายได้อื่น ๆ ประจำงวด", **Then** Popup สำหรับกรอกข้อมูลเกี่ยวกับรายได้ต่าง ๆ ในงวด ในรูปแบบตาราง แต่ละ row คือรายละเอียด 1 รายการ ประกอบด้วย Field : รายการ, จำนวนเงิน, หมายเหตุ และเมื่อกรอกข้อมูลที่ row สุดท้ายที่แสดง จะมี row ใหม่โผล่มาให้กรอกต่อเสมอ
4. **Given** ทำการบันทึก รายได้อื่น ๆ ประจำงวด , **When** หลังจากกรอกข้อมูลครบแล้ว กดปุ่มบันทึก, **Then** ระบบจัดเก็บข้อมูลลงฐานข้อมูลพนักงานว่าในงวดนี้มีกี่รายการ รายการละเท่าไร และคำนวณยอดรวม รายได้อื่น ๆ ประจำงวด ว่าเท่าไร เพื่อแสดงในตารางสรุปการคำนวณเป็นยอดดังกล่าว
5. **Given** ผู้ใช้งานกรอกข้อมูล รายจ่ายอื่น ๆ ประจำงวด, **When** ผู้ใช้เข้าหน้า WageCalculation และหลังจากกดปุ่มคำนวณ ที่รายชื่อแต่ละคนกดที่ปุ่ม "รายจ่ายอื่น ๆ ประจำงวด", **Then** Popup สำหรับกรอกข้อมูลเกี่ยวกับรายจ่ายต่าง ๆ ในงวด ในรูปแบบตาราง แต่ละ row คือรายละเอียด 1 รายการ ประกอบด้วย Field : รายการ, จำนวนเงิน, หมายเหตุ และเมื่อกรอกข้อมูลที่ row สุดท้ายที่แสดง จะมี row ใหม่โผล่มาให้กรอกต่อเสมอ
6. **Given** ทำการบันทึก รายจ่ายอื่น ๆ ประจำงวด , **When** หลังจากกรอกข้อมูลครบแล้ว กดปุ่มบันทึก, **Then** ระบบจัดเก็บข้อมูลลงฐานข้อมูลพนักงานว่าในงวดนี้มีกี่รายการ รายการละเท่าไร และคำนวณยอดรวม รายจ่ายอื่น ๆ ประจำงวด ว่าเท่าไร เพื่อแสดงในตารางสรุปการคำนวณเป็นยอดดังกล่าว
7. **Given** บันทึกเสร็จสิ้นการคำนวณ , **When** หลังจากตรวจสอบและลงข้อมูลครบ User กดปุ่ม บันทึกค่าแรงประจำงวด, **Then** ระบบจัดเก็บข้อมูลลงฐานข้อมูลว่าในแต่ละ Field ในงวดนี้เก็บอะไรไว้บ้างมีค่าเท่าไรบ้าง และต้องสามารถดึงข้อมูลถึงกัน เพื่ออ้างอิงได้ ดังนั้นต้อง Link Primary Key เข้ากับ รายได้อื่น ๆ ประจำงวด, รายจ่ายอื่น ๆ ประจำงวด ที่บันทึกไว้ใน Collection อื่น ๆ ด้วย


---

### User Story 8 - การจัดการข้อมูลสแกนนิ้วและตรวจสอบความถูกต้อง (ScanData Management & Monitoring) (Priority: P8)

ในฐานะ Admin ฉันต้องการอัปโหลดข้อมูลการสแกนนิ้วจากไฟล์ Excel เพื่อเทียบกับ Daily Report ที่บันทึกไว้ และตรวจสอบความผิดปกติ เพื่อให้การคำนวณค่าแรงมีความถูกต้องและสามารถติดตามแก้ไขข้อมูลที่ผิดพลาดได้

**Why this priority**: เป็นฟังก์ชันตรวจสอบความถูกต้องของข้อมูลที่สำคัญต่อการคำนวณค่าแรง ช่วยป้องกันการจ่ายค่าแรงผิดพลาด และเพิ่มความโปร่งใสในการจัดการ

**Independent Test**: สามารถทดสอบได้โดยอัปโหลดไฟล์ Excel ที่มี fields: EmployeeNumber, Date และระบบจะประมวลผลข้อมูลการสแกนนิ้วตามพฤติกรรม 7 รูปแบบ (OT เช้า, เข้างานปกติ, มาสาย, พักเที่ยง, ออกงานปกติ, OT เที่ยง, OT เย็น) จากนั้นเทียบกับ Daily Report และแสดงความผิดปกติใน Dashboard

**Acceptance Scenarios**:

1. **Given** Admin เข้าเมนู Wage Calculation, **When** คลิกปุ่ม "Upload ScanData", **Then** ระบบแสดง Dialog สำหรับเลือกไฟล์ Excel ที่มี fields: EmployeeNumber, Date (วันที่และเวลา)
2. **Given** Admin เลือกไฟล์ Excel และอัปโหลด, **When** กดปุ่ม "Import", **Then** ระบบอ่านข้อมูลและบันทึกลง Collection ScanData พร้อมแสดงสรุปจำนวนรายการที่ import สำเร็จ
3. **Given** ระบบมีข้อมูล ScanData แล้ว, **When** ประมวลผลข้อมูลสแกนนิ้ว, **Then** ระบบจัดประเภทพฤติกรรมการสแกนนิ้วตามเงื่อนไข:
   - **OT เช้า (เข้า)**: สแกนนิ้วช่วง 03:00-07:30 น.
   - **OT เช้า (ออก)**: มีสแกนเข้า OT เช้าก่อนหน้า และสแกนออกช่วง 03:00-07:30 น. → คำนวณชั่วโมง OT เช้า (ปัดนาทีลงหลัก 5)
   - **เข้างานปกติ**: สแกนครั้งแรกของวันช่วง 00:00-08:00 น.
   - **มาสาย**: สแกนครั้งแรกของวันหลัง 08:00 น. → บันทึกจำนวนนาทีที่มาสาย
   - **พักเที่ยง**: สแกนนิ้ว 2 ครั้งช่วง 12:00-13:00 น. (ไม่สำคัญต่อการคำนวณ)
   - **ออกงานปกติ**: สแกนช่วง 17:00-18:00 น. และมีสแกนเข้างานก่อนหน้า → คำนวณชั่วโมงทำงานปกติ (สูงสุด 8 ชม./วัน หักพักเที่ยง ไม่หักมาสาย)
   - **OT เที่ยง**: ไม่มีสแกนนิ้วช่วง 12:00-13:00 น. และ Daily Report มี OT เที่ยง → นับ 1 ชม.
   - **OT เย็น (เข้า)**: สแกนช่วง 17:00-18:00 น. และมีสแกนเข้างานก่อนหน้า
   - **OT เย็น (ออก)**: มีสแกนเข้า OT เย็นก่อนหน้า และสแกนออกช่วง 18:00-24:00 น. → คำนวณชั่วโมง OT เย็น (ปัดนาทีลงหลัก 5)
4. **Given** ระบบประมวลผล ScanData เสร็จ, **When** เทียบกับ Daily Report, **Then** ระบบคำนวณ:
   - **จำนวนชั่วโมงปกติรวมทั้งงวด**: นับเฉพาะวันที่ Daily Report ≥ ScanData
   - **จำนวนชั่วโมง OT รวมทั้งงวด**: แยก OT เช้า/เที่ยง/เย็น นับเฉพาะวันที่ Daily Report ≥ ScanData
5. **Given** ระบบเทียบข้อมูล, **When** พบความผิดปกติ, **Then** ระบบบันทึกรายการผิดปกติ 3 ประเภท:
   - **Type 1**: Daily Report มีชั่วโมงทำงาน < ScanData → แสดงเป็นสีแดง "Daily Report ต่ำกว่าข้อมูลจริง"
   - **Type 2**: Daily Report มีบันทึก แต่ ScanData ไม่มีข้อมูลในวันที่นั้น → แสดงเป็นสีเหลือง "ไม่มีข้อมูลสแกนนิ้ว"
   - **Type 3**: Daily Report ไม่มีบันทึก แต่ ScanData มีข้อมูล → แสดงเป็นสีส้ม "มีข้อมูลสแกนนิ้วแต่ไม่มี Daily Report"
6. **Given** ผู้ใช้เข้า Dashboard, **When** มีข้อมูลความผิดปกติ, **Then** ระบบแสดง Widget "ScanData Monitoring" ที่แสดง:
   - จำนวนรายการผิดปกติทั้งหมด (แยกตาม Type)
   - รายชื่อ DC ที่มีความผิดปกติ (คลิกเพื่อดูรายละเอียด)
   - ตัวกรองตามช่วงวันที่ โครงการ และประเภทความผิดปกติ
7. **Given** ผู้ใช้คลิกดูรายละเอียดความผิดปกติ, **When** เข้าหน้า ScanData Detail, **Then** ระบบแสดงตารางเปรียบเทียบ:
   - คอลัมน์ซ้าย: ข้อมูล Daily Report (วันที่, เวลาเริ่ม-จบ, ชั่วโมงทำงาน, OT)
   - คอลัมน์ขวา: ข้อมูล ScanData (เวลาสแกนเข้า-ออก, ชั่วโมงคำนวณจากสแกน)
   - Highlight ส่วนที่ขัดแย้งกันเป็นสีแดง/เหลือง/ส้ม
8. **Given** ผู้ใช้ต้องการแก้ไขความผิดปกติ, **When** คลิกปุ่ม "แก้ไข" ในรายการผิดปกติ, **Then** ระบบให้ตัวเลือก:
   - แก้ไข Daily Report ให้ตรงกับ ScanData
   - เพิ่ม Daily Report ใหม่ (กรณี Type 3)
   - ทำเครื่องหมายว่า "ตรวจสอบแล้ว" (ถ้าข้อมูล Daily Report ถูกต้อง)
9. **Given** ผู้ใช้คำนวณค่าแรงประจำงวด, **When** มีความผิดปกติที่ยังไม่ได้แก้ไข, **Then** ระบบแสดง Warning "มีข้อมูล X รายการที่ยังไม่ตรงกัน กรุณาตรวจสอบก่อนบันทึกค่าแรง" และให้ตัวเลือก:
   - ดำเนินการต่อ (ยึดข้อมูล Daily Report)
   - ไปแก้ไขความผิดปกติก่อน
10. **Given** มีการบันทึกข้อมูลมาสาย, **When** ผู้ใช้เข้าหน้า "รายจ่ายอื่น ๆ ประจำงวด", **Then** ระบบแสดงรายการมาสายพร้อม:
    - วันที่มาสาย
    - จำนวนนาทีที่มาสาย
    - แนะนำยอดหักเงินตามอัตราที่กำหนด (ถ้ามี)

---

### Edge Cases

- **เมื่อผู้ใช้เลือกแรงงานจำนวนมาก (Multi Select) ในหน้า Daily Report**: ระบบต้องจัดการข้อมูลได้โดยไม่มีข้อจำกัดจำนวน หรือมีการแจ้งเตือนหากเกินจำนวนที่กำหนด
- **เมื่อผู้ใช้กรอกเวลาสิ้นสุดก่อนเวลาเริ่มต้น**: ระบบต้องแสดงข้อความแจ้งเตือนและไม่อนุญาตให้บันทึกข้อมูล
- **เมื่อผู้ใช้พยายามบันทึก Daily Report โดยไม่กรอกข้อมูลบังคับ**: ระบบต้องแสดงข้อความแจ้งเตือนระบุ field ที่ยังไม่ได้กรอก
- **เมื่อผู้ใช้พยายามเข้าถึง Project ที่ไม่มีสิทธิ์**: ระบบต้องบล็อกการเข้าถึงและแสดงข้อความแจ้งว่าไม่มีสิทธิ์
- **เมื่อ Admin ลบผู้ใช้ที่มี Daily Report อยู่แล้ว**: ระบบต้องจัดการข้อมูล Daily Report เดิมอย่างเหมาะสม (เก็บไว้หรือทำ soft delete)
- **เมื่อผู้ใช้บันทึก OT ซ้อนทับกับเวลาทำงานปกติ**: ระบบต้องป้องกันไม่ให้บันทึก OT ในช่วงเวลาที่ซ้อนทับกับเวลาทำงานปกติ และแสดงข้อความแจ้งเตือน
- **เมื่อมีการบันทึก Daily Report ซ้ำสำหรับแรงงานคนเดียวกันในช่วงเวลาเดียวกัน**: ระบบต้องเก็บข้อมูลเป็น Edit History โดยบันทึกทุกครั้งที่มีการแก้ไข ผู้ใช้สามารถเรียกดูประวัติการแก้ไขย้อนหลังได้ แต่ข้อมูลที่ใช้ในการแสดงผลและคำนวณจะเป็นเวอร์ชันล่าสุดเท่านั้น
- **เมื่อผู้ใช้พยายามสร้าง Username ซ้ำในระบบ**: ระบบต้องแจ้งเตือนและไม่อนุญาตให้สร้าง Username ซ้ำ
- **เมื่อผู้ใช้สร้างงวดค่าแรงที่มีช่วงวันที่ไม่ใช่ 15 วัน**: ระบบต้องแจ้งเตือนและแนะนำให้ปรับช่วงวันที่เป็น 15 วัน
- **เมื่อมี DC ที่ไม่มีข้อมูลรายได้หรือรายจ่ายครบถ้วน**: ระบบต้องแสดง warning หรือใช้ค่า default (0) และแจ้งเตือนให้ผู้ใช้ตรวจสอบ
- **เมื่อคำนวณประกันสังคมข้ามเดือน**: ระบบต้องคำนวณประกันสังคมที่ชำระแล้วในเดือนได้ถูกต้องแม้งวดค่าแรงข้ามเดือน (เช่น วันที่ 25 ของเดือนหนึ่งถึงวันที่ 10 ของเดือนถัดไป)
- **เมื่อผู้ใช้พยายามลบงวดค่าแรงที่บันทึกแล้ว**: ระบบต้องยืนยันการลบและอาจเก็บข้อมูลเป็น soft delete เพื่อการตรวจสอบย้อนหลัง
- **เมื่อ DC ไม่มี Daily Report ในช่วงงวดค่าแรง**: ระบบต้องแสดง DC นั้นในตารางสรุปด้วยชั่วโมงงาน = 0 และรายได้/รายจ่ายตามข้อมูลที่มี
- **เมื่อกรอกรายได้/รายจ่ายอื่น ๆ เป็นจำนวนติดลบ**: ระบบต้องป้องกันไม่ให้บันทึกค่าติดลบหรือแจ้งเตือน
- **เมื่อ Export Excel ไฟล์ใหญ่เกินไป**: ระบบต้องจัดการได้โดยอาจแบ่งเป็นหลายไฟล์หรือแสดง progress bar
- **เมื่อ Upload ไฟล์ Excel ScanData ที่มี format ไม่ถูกต้อง**: ระบบต้องแสดงข้อความแจ้งเตือนระบุ fields ที่ขาดหายหรือ format ที่ไม่ถูกต้อง
- **เมื่อ ScanData มี EmployeeNumber ที่ไม่มีในระบบ**: ระบบต้องแสดง Warning และให้ตัวเลือกข้ามรายการนั้นหรือสร้าง DC ใหม่
- **เมื่อมีการสแกนนิ้วมากกว่า 2 ครั้งในช่วงเวลาเดียวกัน**: ระบบต้องใช้การสแกนครั้งแรกและครั้งสุดท้ายในช่วงนั้น และแจ้งเตือนถ้าผิดปกติ
- **เมื่อ Daily Report ≥ ScanData แต่ต่างกันมาก (เช่น 8 ชม. vs 4 ชม.)**: ระบบต้องแสดง High Priority Warning เพื่อให้ตรวจสอบ
- **เมื่อ DC มีข้อมูลมาสายหลายครั้งในงวด**: ระบบต้องรวมจำนวนนาทีมาสายทั้งหมดและแสดงในหน้ารายจ่ายอื่น ๆ
- **เมื่อข้อมูล ScanData ข้ามวันที่ (OT ถึงหลังเที่ยงคืน)**: ระบบต้องคำนวณชั่วโมง OT ได้ถูกต้องโดยนับจากวันที่เริ่มงาน

## Requirements *(mandatory)*

### Functional Requirements

#### Dashboard และ Navigation (FR-D)

- **FR-D-001**: ระบบต้องแสดงจำนวนแรงงาน Active ทั้งหมดในปัจจุบันบนหน้า Dashboard และ Widget "ScanData Monitoring" ที่แสดงความผิดปกติระหว่าง ScanData และ Daily Report
- **FR-D-002**: ระบบต้องมี Navbar ที่แสดงเมนูหลัก: Dashboard, New Project, Member Management, DC Management, Daily Report และ Wage Calculation
- **FR-D-003**: ผู้ใช้ต้องสามารถคลิกเมนูใน Navbar เพื่อนำทางไปยังหน้าต่างๆ ได้
- **FR-D-004**: Navbar ต้องแสดงบนทุกหน้าของระบบเพื่อให้นำทางได้ตลอดเวลา

#### Daily Report - เวลาปกติ (FR-DR)

- **FR-DR-001**: ระบบต้องมีหน้าสำหรับบันทึก Daily Report ที่มี fields: Project, DC List, Task Name, Date, Start Time, End Time
- **FR-DR-002**: Field "Project" ต้องตั้งค่า default เป็น Project Location ล่าสุดจากฐานข้อมูล
- **FR-DR-003**: Field "DC List" ต้องแสดงรายชื่อแรงงานรายวันที่อยู่ในโครงการที่เลือก โดยใช้ Auto Complete
- **FR-DR-004**: Field "DC List" ต้องรองรับการเลือกหลายคน (Multi Select)
- **FR-DR-005**: Field "Date" ต้องตั้งค่า default เป็นวันที่ปัจจุบัน
- **FR-DR-006**: ผู้ใช้ต้องสามารถกรอกข้อมูลหลายชุดในหน้าเดียวกัน เพื่อรองรับกรณีทำงานครึ่งวันเช้า 1 งาน และบ่ายอีก 1 งาน
- **FR-DR-007**: ระบบต้องตรวจสอบว่า fields บังคับ (Project, DC List, Task Name, Date, Start Time, End Time) ถูกกรอกครบก่อนบันทึก
- **FR-DR-008**: ระบบต้องตรวจสอบว่า End Time มากกว่า Start Time ก่อนบันทึกข้อมูล
- **FR-DR-009**: เมื่อมีการแก้ไข Daily Report ที่มีอยู่แล้ว ระบบต้องเก็บ Edit History โดยบันทึกเวอร์ชันเก่าพร้อม timestamp และผู้แก้ไข
- **FR-DR-010**: ผู้ใช้ต้องสามารถเรียกดูประวัติการแก้ไข (Edit History) ของ Daily Report แต่ละรายการได้
- **FR-DR-011**: ข้อมูลที่ใช้ในการแสดงผลและคำนวณต้องเป็นเวอร์ชันล่าสุดของ Daily Report เท่านั้น

#### Daily Report - Overtime (FR-OT)

- **FR-OT-001**: หน้า Daily Report ต้องมี tab สำหรับบันทึก Overtime แยกจากเวลาปกติ
- **FR-OT-002**: Tab Overtime ต้องแบ่งเป็น 3 ชุดข้อมูล: OT เช้า, OT กลางวัน, OT เย็น
- **FR-OT-003**: แต่ละชุด OT ต้องมี fields เหมือนกับเวลาปกติ: Project, DC List, Task Name, Date, Start Time, End Time
- **FR-OT-004**: ผู้ใช้ต้องสามารถบันทึก OT 1, 2 หรือ 3 ชุดพร้อมกันได้ (ไม่จำเป็นต้องกรอกครบทั้ง 3 ชุด)
- **FR-OT-005**: ระบบต้องบันทึกข้อมูล OT แยกจากเวลาปกติ และระบุช่วงเวลา OT (เช้า/กลางวัน/เย็น)
- **FR-OT-006**: ระบบต้องตรวจสอบว่าช่วงเวลา OT ไม่ซ้อนทับกับเวลาทำงานปกติของแรงงานคนเดียวกันในวันเดียวกัน
- **FR-OT-007**: หากตรวจพบ OT ซ้อนทับกับเวลาปกติ ระบบต้องป้องกันการบันทึกและแสดงข้อความแจ้งเตือน

#### Project Management (FR-P)

- **FR-P-001**: ผู้ใช้ที่มีสิทธิ์ต้องสามารถเพิ่มโครงการใหม่ (Project Location) เข้าสู่ระบบได้
- **FR-P-002**: ข้อมูลโครงการที่เพิ่มต้องปรากฏใน dropdown "Project" ของหน้า Daily Report
- **FR-P-003**: ระบบต้องเก็บข้อมูลโครงการอย่างน้อย: ชื่อโครงการ และ สถานที่

#### Member Management (FR-M)

- **FR-M-001**: Admin ต้องสามารถเพิ่ม/แก้ไข/ลบข้อมูลผู้ใช้ (User) ได้
- **FR-M-002**: ข้อมูลผู้ใช้ต้องประกอบด้วย: Employee ID, Username, Password, Name, Role, วันเกิด, วันที่เริ่มงาน
- **FR-M-003**: Role ต้องมีตัวเลือก: Admin (AM), Foreman (FM), Site Eng. (SE), Office Eng. (OE), Project Engineer (PE), Project Manager (PM), Project Director (PD), Managing Director (MD)
- **FR-M-004**: Admin ต้องสามารถกำหนดสิทธิ์การเข้าถึง Project Location ให้กับผู้ใช้แต่ละคนได้
- **FR-M-005**: ระบบต้องไม่อนุญาตให้สร้าง Username ซ้ำ
- **FR-M-006**: Password ต้องถูกเก็บอย่างปลอดภัย (hashed)

#### DC Management (FR-DC)

- **FR-DC-001**: ผู้ใช้ที่มีสิทธิ์ต้องสามารถเพิ่ม/แก้ไข/ลบข้อมูลแรงงานรายวัน (DC) ได้
- **FR-DC-002**: ข้อมูล DC ต้องประกอบด้วย: Employee ID, Username, Password, Name, Skill
- **FR-DC-003**: DC ที่เพิ่มต้องปรากฏใน Auto Complete field "DC List" ของหน้า Daily Report
- **FR-DC-004**: ระบบต้องเชื่อมโยง DC กับ Project Location ที่พวกเขาสามารถทำงานได้

#### Authorization (FR-A)

- **FR-A-001**: ผู้ใช้ต้องเข้าสู่ระบบก่อนใช้งานฟังก์ชันใดๆ
- **FR-A-002**: ระบบต้องตรวจสอบสิทธิ์การเข้าถึง Project Location ตาม Role และสิทธิ์ที่กำหนดไว้
- **FR-A-003**: เฉพาะ Admin, OE, PE, PM และ PD ที่สามารถเข้าถึงเมนู New Project ได้
- **FR-A-004**: เฉพาะ Admin ที่สามารถเข้าถึงเมนู Member Management ได้
- **FR-A-005**: Admin และ Foreman สามารถเข้าถึงเมนู DC Management ได้
- **FR-A-006**: Admin, PM, PD และ MD สามารถเข้าถึงเมนู Wage Calculation ได้
- **FR-A-007**: ผู้ใช้ที่มี Role เป็น PD สามารถเข้าถึงโครงการที่อยู่ในสังกัด (PD01-PD05) เดียวกันเท่านั้น
- **FR-A-008**: ผู้ใช้ที่มี Role เป็น MD สามารถเข้าถึงทุกโครงการในระบบ

#### Language และ Internationalization (FR-L)

- **FR-L-001**: ระบบทั้งหมดต้องใช้ภาษาไทยในส่วนติดต่อผู้ใช้ (UI)
- **FR-L-002**: รหัสและ comments ในโค้ดต้องใช้ภาษาไทยเพื่อความเข้าใจและการบำรุงรักษาในอนาคต

#### Wage Calculation (FR-WC)

- **FR-WC-001**: ระบบต้องมีหน้า Wage Calculation ที่ผู้ใช้ที่มีสิทธิ์สามารถเข้าถึงได้
- **FR-WC-002**: ผู้ใช้ต้องสามารถสร้างงวดตัดค่าแรงใหม่ได้ โดยระบุ: วันที่เริ่มต้นงวด, วันที่สิ้นสุดงวด (ระยะเวลา 15 วัน), โครงการ
- **FR-WC-003**: ระบบต้องตั้งค่า default โครงการตามสังกัดที่ผู้ใช้อยู่
- **FR-WC-004**: เมื่อกดปุ่ม "เริ่มคำนวณ" ระบบต้องดึงข้อมูลจากฐานข้อมูล: ข้อมูล DC (รายละเอียดรายได้และรายจ่าย), Daily Report ทั้งหมดที่อยู่ในช่วงวันที่เริ่มต้นและสิ้นสุดงวด
- **FR-WC-005**: ระบบต้องคำนวณจำนวนชั่วโมงปกติรวมทั้งงวดสำหรับแต่ละ DC จาก Daily Report ที่บันทึกไว้
- **FR-WC-006**: ระบบต้องคำนวณจำนวนชั่วโมง OT รวมทั้งงวดสำหรับแต่ละ DC (รวม OT เช้า, กลางวัน, เย็น)
- **FR-WC-007**: ระบบต้องคำนวณค่าแรงปกติรวม = จำนวนชั่วโมงปกติรวมทั้งงวด × ค่าแรงต่อชั่วโมง
- **FR-WC-008**: ระบบต้องคำนวณค่าแรง OT รวม = จำนวนชั่วโมง OT รวมทั้งงวด × ค่าแรงต่อชั่วโมง × 1.5
- **FR-WC-009**: ระบบต้องคำนวณค่าวิชาชีพรวม = จำนวนชั่วโมงปกติรวมทั้งงวด × ค่าวิชาชีพต่อชั่วโมง
- **FR-WC-010**: ระบบต้องคำนวณค่าที่พักผู้ติดตามต่องวด = จำนวนผู้ติดตาม × 300 บาท
- **FR-WC-011**: ระบบต้องคำนวณยอดประกันสังคมที่ควรจ่าย = ยอดรวมค่าแรงปกติ × 0.05
- **FR-WC-012**: ระบบต้องคำนวณยอดจ่ายประกันสังคมที่ชำระแล้วในเดือน = ยอดรวมค่าแรงปกติในเดือนเดียวกันกับวันเริ่มงวด × 0.05
- **FR-WC-013**: ระบบต้องคำนวณยอดจ่ายประกันสังคมประจำงวดตามเงื่อนไข: ถ้า Employee ID ขึ้นต้นด้วย "9" ให้คืนค่า 0, ถ้าไม่ใช่ ใช้สูตร: if(ยอดประกันสังคมที่ควรจ่าย + ยอดจ่ายประกันสังคมที่ชำระแล้วในเดือน > 750, 750 - ยอดจ่ายประกันสังคมที่ชำระแล้วในเดือน, if(ยอดประกันสังคมที่ควรจ่าย > 83, ยอดประกันสังคมที่ควรจ่าย, 83))
- **FR-WC-014**: ผู้ใช้ต้องสามารถคลิกปุ่ม "รายได้อื่น ๆ ประจำงวด" ที่รายชื่อแต่ละ DC เพื่อเพิ่มรายได้พิเศษในงวด
- **FR-WC-015**: Popup "รายได้อื่น ๆ ประจำงวด" ต้องแสดงตารางที่มี fields: รายการ, จำนวนเงิน, หมายเหตุ โดยแต่ละ row คือ 1 รายการ
- **FR-WC-016**: เมื่อกรอกข้อมูลที่ row สุดท้ายของตาราง รายได้อื่น ๆ ระบบต้องเพิ่ม row ใหม่อัตโนมัติ
- **FR-WC-017**: เมื่อบันทึก "รายได้อื่น ๆ ประจำงวด" ระบบต้องเก็บข้อมูลลงฐานข้อมูลและคำนวณยอดรวมรายได้อื่น ๆ
- **FR-WC-018**: ผู้ใช้ต้องสามารถคลิกปุ่ม "รายจ่ายอื่น ๆ ประจำงวด" ที่รายชื่อแต่ละ DC เพื่อเพิ่มรายจ่ายพิเศษในงวด
- **FR-WC-019**: Popup "รายจ่ายอื่น ๆ ประจำงวด" ต้องแสดงตารางที่มี fields: รายการ, จำนวนเงิน, หมายเหตุ โดยแต่ละ row คือ 1 รายการ
- **FR-WC-020**: เมื่อกรอกข้อมูลที่ row สุดท้ายของตาราง รายจ่ายอื่น ๆ ระบบต้องเพิ่ม row ใหม่อัตโนมัติ
- **FR-WC-021**: เมื่อบันทึก "รายจ่ายอื่น ๆ ประจำงวด" ระบบต้องเก็บข้อมูลลงฐานข้อมูลและคำนวณยอดรวมรายจ่ายอื่น ๆ
- **FR-WC-022**: ระบบต้องคำนวณยอดรวมรายได้ = ยอดรวมค่าแรงปกติ + ยอดรวมค่าแรง OT + ยอดรวมค่าวิชาชีพ + ค่าโทรศัพธ์ต่องวด + ยอดรายได้อื่น ๆ ประจำงวด
- **FR-WC-023**: ระบบต้องคำนวณยอดรวมรายจ่าย = ค่าที่พักต่องวด + ค่าที่พักผู้ติดตามต่องวด + ค่าใช้ตู้เย็นต่องวด + ค่าใช้เครื่องเสียงต่องวด + ค่าใช้ทีวีต่องวด + ค่าใช้เครื่องซักผ้าต่องวด + ค่าใช้แอร์เคลื่อนที่ต่องวด + รายจ่ายอื่น ๆ ประจำงวด + ยอดจ่ายประกันสังคมประจำงวด
- **FR-WC-024**: ระบบต้องคำนวณยอดสุทธิ = ยอดรวมรายได้ - ยอดรวมรายจ่าย
- **FR-WC-025**: ระบบต้องแสดงตารางสรุปการคำนวณที่ประกอบด้วย fields ทั้งหมดที่ระบุใน Independent Test ของ User Story 7
- **FR-WC-026**: เมื่อผู้ใช้กดปุ่ม "บันทึกค่าแรงประจำงวด" ระบบต้องเก็บข้อมูลทั้งหมดลงฐานข้อมูล
- **FR-WC-027**: ระบบต้อง Link Primary Key ของงวดค่าแรงเข้ากับ "รายได้อื่น ๆ ประจำงวด" และ "รายจ่ายอื่น ๆ ประจำงวด" ที่บันทึกไว้ใน Collection อื่น ๆ
- **FR-WC-028**: ระบบต้องสามารถ Export ข้อมูลสรุปค่าแรงออกเป็นไฟล์ Excel ได้
- **FR-WC-029**: ผู้ใช้ต้องสามารถแก้ไขงวดตัดค่าแรงที่สร้างไว้แล้วได้
- **FR-WC-030**: ผู้ใช้ต้องสามารถลบงวดตัดค่าแรงได้

#### ScanData Management และ Monitoring (FR-SD)

- **FR-SD-001**: ระบบต้องมีปุ่ม "Upload ScanData" ในหน้า Wage Calculation สำหรับ Admin
- **FR-SD-002**: ระบบต้องรองรับการอัปโหลดไฟล์ Excel ที่มี fields: EmployeeNumber (รหัสพนักงาน), Date (วันที่และเวลา)
- **FR-SD-003**: ระบบต้องตรวจสอบ format ไฟล์ Excel ก่อน import และแจ้งเตือนถ้า fields ไม่ครบหรือ format ไม่ถูกต้อง
- **FR-SD-004**: ระบบต้องบันทึกข้อมูล ScanData ลง Collection แยกต่างหาก พร้อม timestamp ของการ import
- **FR-SD-005**: ระบบต้องประมวลผลข้อมูล ScanData และจัดประเภทพฤติกรรมการสแกนนิ้วตามเงื่อนไข 7 รูปแบบ:
  - OT เช้า (เข้า): สแกนช่วง 03:00-07:30 น.
  - OT เช้า (ออก): มีสแกนเข้าก่อนหน้า + สแกนออกช่วง 03:00-07:30 น.
  - เข้างานปกติ: สแกนครั้งแรกของวันช่วง 00:00-08:00 น.
  - มาสาย: สแกนครั้งแรกของวันหลัง 08:00 น.
  - พักเที่ยง: สแกน 2 ครั้งช่วง 12:00-13:00 น. (optional)
  - ออกงานปกติ: สแกนช่วง 17:00-18:00 น. + มีสแกนเข้างาน
  - OT เที่ยง: ไม่มีสแกนช่วง 12:00-13:00 น. + Daily Report มี OT เที่ยง = 1 ชม.
  - OT เย็น (เข้า): สแกนช่วง 17:00-18:00 น. + มีสแกนเข้างาน
  - OT เย็น (ออก): มีสแกนเข้า OT เย็น + สแกนออกช่วง 18:00-24:00 น.
- **FR-SD-006**: ระบบต้องคำนวณชั่วโมงทำงานจาก ScanData โดยปัดนาทีลงที่หลัก 5 นาที (58→55, 54→50, 53→50)
- **FR-SD-007**: ระบบต้องคำนวณชั่วโมงทำงานปกติ โดยหักเวลาพักเที่ยง ไม่หักเวลามาสาย สูงสุด 8 ชม./วัน
- **FR-SD-008**: ระบบต้องเทียบข้อมูล ScanData กับ Daily Report และใช้หลักการ "Daily Report ≥ ScanData" ในการนับชั่วโมงทำงาน
- **FR-SD-009**: ระบบต้องตรวจจับและบันทึกความผิดปกติ 3 ประเภท:
  - Type 1 (สีแดง): Daily Report < ScanData
  - Type 2 (สีเหลือง): Daily Report มี แต่ ScanData ไม่มี
  - Type 3 (สีส้ม): Daily Report ไม่มี แต่ ScanData มี
- **FR-SD-010**: Dashboard ต้องมี Widget "ScanData Monitoring" ที่แสดง:
  - จำนวนความผิดปกติทั้งหมดแยกตาม Type
  - รายชื่อ DC ที่มีความผิดปกติ (คลิกดูรายละเอียด)
  - ตัวกรองตามวันที่ โครงการ ประเภทความผิดปกติ
- **FR-SD-011**: ระบบต้องมีหน้า ScanData Detail ที่แสดงตารางเปรียบเทียบ Daily Report vs ScanData แบบ side-by-side
- **FR-SD-012**: ระบบต้อง Highlight ส่วนที่ขัดแย้งกันด้วยสีตามประเภทความผิดปกติ
- **FR-SD-013**: ผู้ใช้ต้องสามารถแก้ไขความผิดปกติได้ 3 วิธี:
  - แก้ไข Daily Report ให้ตรงกับ ScanData
  - เพิ่ม Daily Report ใหม่ (กรณี Type 3)
  - ทำเครื่องหมาย "ตรวจสอบแล้ว" (Verified)
- **FR-SD-014**: เมื่อคำนวณค่าแรงประจำงวดและมีความผิดปกติที่ยังไม่แก้ไข ระบบต้องแสดง Warning พร้อมตัวเลือก "ดำเนินการต่อ" หรือ "ไปแก้ไข"
- **FR-SD-015**: ระบบต้องบันทึกข้อมูลการมาสาย (จำนวนนาที) และแสดงในหน้า "รายจ่ายอื่น ๆ ประจำงวด"
- **FR-SD-016**: ระบบต้องรองรับการคำนวณ OT ที่ข้ามวันที่ (เช่น เริ่ม 17:00 จบ 01:00 วันถัดไป)
- **FR-SD-017**: ระบบต้องแจ้งเตือนถ้ามี EmployeeNumber ใน ScanData ที่ไม่มีในระบบ
- **FR-SD-018**: ระบบต้องจัดการกรณีที่มีการสแกนนิ้วหลายครั้งในช่วงเวลาเดียวกัน โดยใช้ครั้งแรกและครั้งสุดท้าย

### Key Entities

- **User (ผู้ใช้)**: ผู้ใช้ระบบที่มีบัญชีเข้าสู่ระบบ ประกอบด้วย Employee ID, Username, Password (hashed), Name, Role (Admin/Foreman/Site Eng./OE/PE/PM/PD/MD), สังกัด (PD01-PD05), วันเกิด, วันที่เริ่มงาน และสิทธิ์การเข้าถึง Project Location ต่างๆ

- **Daily Contractor (DC / แรงงานรายวัน)**: แรงงานรายวันที่ทำงานในโครงการ ประกอบด้วย Employee ID, Username, Password (hashed), Name, Skill และความเชื่อมโยงกับ Project Location ที่สามารถทำงานได้

- **Project Location (โครงการ)**: สถานที่หรือโครงการที่แรงงานทำงาน ประกอบด้วย ชื่อโครงการ, สถานที่ และความเชื่อมโยงกับ Users และ DCs ที่มีสิทธิ์เข้าถึง

- **Daily Report (รายงานประจำวัน)**: บันทึกการทำงานของแรงงานในแต่ละวัน ประกอบด้วย Project Location, รายชื่อ DC (อาจมีหลายคน), Task Name (งานที่ทำ), Date (วันที่), Start Time (เวลาเริ่ม), End Time (เวลาจบ), ชนิดของเวลา (ปกติ/OT), ช่วงเวลา OT (เช้า/กลางวัน/เย็น) หากเป็น OT, และ Edit History (ประวัติการแก้ไข) ที่เก็บเวอร์ชันก่อนหน้าทั้งหมด

- **Edit History (ประวัติการแก้ไข)**: บันทึกการเปลี่ยนแปลงของ Daily Report แต่ละรายการ ประกอบด้วย เวอร์ชันข้อมูลเก่า, Timestamp (เวลาที่แก้ไข), ผู้แก้ไข (User), และข้อมูลทั้งหมดของเวอร์ชันนั้นๆ

- **Role (บทบาท)**: บทบาทของผู้ใช้ในระบบ ได้แก่ Admin (AM - ผู้ดูแลระบบ), Foreman (FM - หัวหน้างาน), Site Engineer (SE - วิศวกรประจำหน้างาน), Office Engineer (OE), Project Engineer (PE), Project Manager (PM), Project Director (PD), Managing Director (MD)

- **Skill (ทักษะ)**: ทักษะหรือความชำนาญของแรงงานรายวัน เช่น ช่างไฟฟ้า, ช่างก่อสร้าง, ผู้ช่วยทั่วไป ฯลฯ

- **File Attachment (ไฟล์แนบ)**: ไฟล์ ภาพ หรือเอกสารที่เกี่ยวข้องกับ Daily Report, Project หรือ DC ประกอบด้วย File Name, File Type, File Size, Upload Date และ URL สำหรับดาวน์โหลด

- **Wage Period (งวดค่าแรง)**: งวดการตัดค่าแรงประจำงวด (15 วัน) ประกอบด้วย วันที่เริ่มต้นงวด, วันที่สิ้นสุดงวด, โครงการที่เกี่ยวข้อง, รายชื่อ DC ที่ได้รับค่าแรง, ข้อมูลการคำนวณทั้งหมด, สถานะการบันทึก และ Primary Key สำหรับเชื่อมโยงกับ Collection อื่นๆ

- **DC Income Details (รายละเอียดรายได้ DC)**: รายละเอียดเงื่อนไขรายได้ของแต่ละ DC ประกอบด้วย ค่าแรงต่อชั่วโมง, ค่าแรง OT ต่อชั่วโมง (คำนวณอัตโนมัติ = ค่าแรงปกติ × 1.5), ค่าวิชาชีพต่อชั่วโมง, ค่าโทรศัพธ์ต่องวด

- **DC Expense Details (รายละเอียดรายจ่าย DC)**: รายละเอียดเงื่อนไขรายจ่ายของแต่ละ DC ประกอบด้วย ค่าที่พักต่องวด, จำนวนผู้ติดตาม, ค่าที่พักผู้ติดตามต่องวด (คำนวณอัตโนมัติ = จำนวนผู้ติดตาม × 300), ค่าใช้ตู้เย็นต่องวด, ค่าใช้เครื่องเสียงต่องวด, ค่าใช้ทีวีต่องวด, ค่าใช้เครื่องซักผ้าต่องวด, ค่าใช้แอร์เคลื่อนที่ต่องวด

- **Additional Income Per Period (รายได้อื่น ๆ ประจำงวด)**: รายการรายได้พิเศษของ DC ในแต่ละงวด บันทึกในรูปแบบตารางที่แต่ละ row เป็น 1 รายการ ประกอบด้วย รายการ, จำนวนเงิน, หมายเหตุ และ Primary Key สำหรับเชื่อมโยงกับงวดค่าแรง

- **Additional Expense Per Period (รายจ่ายอื่น ๆ ประจำงวด)**: รายการรายจ่ายพิเศษของ DC ในแต่ละงวด บันทึกในรูปแบบตารางที่แต่ละ row เป็น 1 รายการ ประกอบด้วย รายการ, จำนวนเงิน, หมายเหตุ และ Primary Key สำหรับเชื่อมโยงกับงวดค่าแรง

- **Social Security Calculation (การคำนวณประกันสังคม)**: การคำนวณประกันสังคมของ DC ในแต่ละงวด ประกอบด้วย ยอดประกันสังคมที่ควรจ่าย (ยอดรวมค่าแรงปกติ × 0.05), ยอดจ่ายประกันสังคมที่ชำระแล้วในเดือน, ยอดจ่ายประกันสังคมประจำงวด (คำนวณตามเงื่อนไข: Employee ID ขึ้นต้นด้วย "9" = 0 บาท, มีเพดานสูงสุด 750 บาท/เดือน, ขั้นต่ำ 83 บาท)

- **ScanData (ข้อมูลสแกนนิ้ว)**: ข้อมูลการสแกนนิ้วเข้า-ออกงานของ DC ประกอบด้วย EmployeeNumber, Date (วันที่และเวลา), ScanType (ประเภทการสแกน: เข้า OT เช้า/ออก OT เช้า/เข้างานปกติ/มาสาย/พักเที่ยง/ออกงานปกติ/เข้า OT เย็น/ออก OT เย็น), ImportTimestamp (เวลาที่ import ข้อมูล), และ ProjectLocation

- **ScanData Discrepancy (ความผิดปกติข้อมูลสแกนนิ้ว)**: บันทึกความผิดพลาดหรือความไม่ตรงกันระหว่าง ScanData และ Daily Report ประกอบด้วย EmployeeNumber, Date, DiscrepancyType (Type 1/2/3), DailyReportHours (ชั่วโมงจาก Daily Report), ScanDataHours (ชั่วโมงจาก ScanData), Status (Pending/Verified/Fixed), และรายละเอียดความผิดปกติ

- **Late Record (บันทึกการมาสาย)**: บันทึกการมาสายของ DC ประกอบด้วย EmployeeNumber, Date, LateMinutes (จำนวนนาทีที่มาสาย), ScanTime (เวลาที่สแกนนิ้ว), และ Link ไปยังงวดค่าแรงที่เกี่ยวข้อง เพื่อใช้แสดงในหน้า "รายจ่ายอื่น ๆ ประจำงวด"

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ผู้ใช้สามารถบันทึก Daily Report สำหรับแรงงาน 1 คนในเวลาไม่เกิน 1 นาที (รวมการเลือกโครงการ, แรงงาน และกรอกเวลา)
- **SC-002**: ผู้ใช้สามารถบันทึก Daily Report สำหรับแรงงานหลายคน (Multi Select) ในเวลาไม่เกิน 2 นาที
- **SC-003**: Dashboard แสดงจำนวนแรงงาน Active ได้ทันทีที่เข้าหน้า (เวลาโหลดไม่เกิน 2 วินาที)
- **SC-004**: ระบบสามารถรองรับผู้ใช้อย่างน้อย 50 คนพร้อมกันโดยไม่มีปัญหาด้านประสิทธิภาพ
- **SC-005**: ผู้ใช้สามารถนำทางระหว่างหน้าต่างๆ ผ่าน Navbar ได้อย่างราบรื่น (เวลาเปลี่ยนหน้าไม่เกิน 1 วินาที)
- **SC-006**: 90% ของผู้ใช้สามารถบันทึก Daily Report ได้ถูกต้องในครั้งแรกโดยไม่มีข้อผิดพลาด
- **SC-007**: ระบบช่วยลดเวลาในการบันทึก Daily Report เมื่อเทียบกับวิธีเดิม (เช่น กระดาษ) อย่างน้อย 50%
- **SC-008**: Auto Complete สำหรับ DC List แสดงผลลัพธ์ที่ตรงกับที่ค้นหาภายใน 0.5 วินาที
- **SC-009**: ผู้ใช้สามารถเพิ่มโครงการใหม่เข้าสู่ระบบได้ในเวลาไม่เกิน 2 นาที
- **SC-010**: Admin สามารถเพิ่ม/แก้ไขข้อมูล User หรือ DC ได้ในเวลาไม่เกิน 3 นาที
- **SC-011**: ผู้ใช้สามารถสร้างงวดตัดค่าแรงและคำนวณค่าแรงสำหรับ DC ทั้งหมดในโครงการได้ในเวลาไม่เกิน 5 นาที
- **SC-012**: ระบบคำนวณค่าแรง OT, ค่าวิชาชีพ, ประกันสังคม และยอดสุทธิได้อัตโนมัติและถูกต้อง 100%
- **SC-013**: ผู้ใช้สามารถเพิ่ม "รายได้อื่น ๆ ประจำงวด" หรือ "รายจ่ายอื่น ๆ ประจำงวด" ได้ในเวลาไม่เกิน 2 นาที
- **SC-014**: ระบบสามารถ Export ข้อมูลสรุปค่าแรงออกเป็นไฟล์ Excel ได้ในเวลาไม่เกิน 10 วินาที
- **SC-015**: การคำนวณประกันสังคมต้องปฏิบัติตามกฎเกณฑ์ (เพดาน 750 บาท/เดือน, ขั้นต่ำ 83 บาท, ยกเว้น Employee ID ขึ้นต้นด้วย "9") ได้ถูกต้อง 100%
- **SC-016**: ผู้ใช้สามารถอัปโหลดไฟล์ Excel ScanData ได้สำเร็จในเวลาไม่เกิน 30 วินาทีสำหรับข้อมูล 1,000 รายการ
- **SC-017**: ระบบประมวลผลและจัดประเภท ScanData ตามพฤติกรรมได้ถูกต้อง 100% ตามเงื่อนไข 7 รูปแบบ
- **SC-018**: ระบบตรวจจับความผิดปกติระหว่าง ScanData และ Daily Report ได้ทั้ง 3 ประเภทอย่างถูกต้อง 100%
- **SC-019**: Dashboard แสดง Widget "ScanData Monitoring" โดยโหลดข้อมูลความผิดปกติได้ภายใน 2 วินาที
- **SC-020**: ผู้ใช้สามารถแก้ไขความผิดปกติ 1 รายการได้ในเวลาไม่เกิน 1 นาที
- **SC-021**: ระบบคำนวณชั่วโมงทำงานจาก ScanData โดยปัดนาทีลงที่หลัก 5 นาทีได้ถูกต้อง 100%
- **SC-022**: ระบบนับชั่วโมงทำงานโดยยึดหลักการ "Daily Report ≥ ScanData" ได้ถูกต้อง 100%

## Assumptions

1. **ระบบมีฐานข้อมูลเดิมอยู่แล้ว**: สมมติว่ามีข้อมูล Project Location, Users และ DCs บางส่วนอยู่ในระบบก่อนแล้ว เพื่อใช้สำหรับการทดสอบและ default values
2. **สิทธิ์การเข้าถึง Project**: สมมติว่า User แต่ละคนอาจมีสิทธิ์เข้าถึงหลาย Projects แต่ DC แต่ละคนสามารถทำงานได้ใน Project ที่ถูกกำหนดไว้เท่านั้น
3. **Auto Complete สำหรับ DC List**: สมมติว่า Auto Complete จะค้นหาจาก Name และ Employee ID ของ DC
4. **งวดค่าแรง**: สมมติว่างวดค่าแรงจะมีระยะเวลา 15 วันเท่านั้น (เช่น วันที่ 1-15 หรือ 16-สิ้นเดือน)
5. **ช่วงเวลา OT**: สมมติว่า OT เช้า = ก่อน 8:00, OT กลางวัน = 12:00-13:00 และหลัง 17:00, OT เย็น = หลัง 20:00 (หรือตามที่ผู้ใช้กำหนด)
6. **Multi Select DC**: สมมติว่าเมื่อเลือกหลายคน ข้อมูล Task Name, Date, Start Time, End Time จะเหมือนกันสำหรับทุกคนที่เลือก (ใช้ข้อมูลชุดเดียวกัน)
7. **Password Security**: สมมติว่าระบบจะใช้ standard hashing algorithm (เช่น bcrypt) สำหรับเก็บ password
8. **การแก้ไข/ลบข้อมูล**: สมมติว่าการลบข้อมูล User หรือ DC จะเป็น soft delete (เก็บข้อมูลไว้ แต่ไม่แสดงในรายการ) เพื่อไม่ให้กระทบกับ Daily Report เดิม
9. **Edit History Storage**: สมมติว่าระบบจะเก็บประวัติการแก้ไขทั้งหมดไว้ไม่จำกัดเวลา (ไม่มีการลบอัตโนมัติ) เพื่อความโปร่งใสและการตรวจสอบย้อนหลัง
10. **File Storage**: สมมติว่าไฟล์ที่อัปโหลดจะถูกเก็บในระบบจัดเก็บแยกต่างหาก และระบบจะเก็บเฉพาะ URL/path สำหรับดาวน์โหลด
11. **ค่าแรง OT**: สมมติว่าค่าแรง OT คำนวณเป็น 1.5 เท่าของค่าแรงปกติเสมอ
12. **ประกันสังคม**: สมมติว่าอัตราประกันสังคม 5% ของค่าแรงปกติ มีเพดาน 750 บาท/เดือน ขั้นต่ำ 83 บาท และ Employee ID ที่ขึ้นต้นด้วย "9" ไม่ต้องจ่ายประกันสังคม
13. **ค่าที่พักผู้ติดตาม**: สมมติว่าค่าที่พักผู้ติดตามคำนวณเป็น 300 บาทต่อคนต่องวดเสมอ
14. **สังกัด (Department)**: สมมติว่าระบบมีสังกัด 5 แห่งคือ PD01, PD02, PD03, PD04, PD05 และโครงการจะถูกจัดกลุ่มตามสังกัด
15. **การ Link ข้อมูล**: สมมติว่าระบบจะใช้ Primary Key เพื่อเชื่อมโยงข้อมูลระหว่าง Collection ต่างๆ (งวดค่าแรง, รายได้อื่น ๆ, รายจ่ายอื่น ๆ)
16. **ScanData Format**: สมมติว่าไฟล์ Excel ScanData จะมี fields: EmployeeNumber (text/number), Date (datetime) เสมอ และระบบจะตรวจสอบ format ก่อน import
17. **เวลาทำงานปกติ**: สมมติว่าเวลาเข้างานปกติคือ 08:00 น. และออกงาน 17:00 น. พักเที่ยง 12:00-13:00 น. (รวม 8 ชม./วัน)
18. **การปัดนาที ScanData**: สมมติว่าการปัดนาทีลงที่หลัก 5 นาที เช่น 58→55, 54→50, 53→50, 52→50, 51→50, 50→50
19. **หลักการยึดข้อมูล**: สมมติว่าระบบจะยึดข้อมูล Daily Report เสมอในการคำนวณค่าแรง โดย ScanData ใช้สำหรับตรวจสอบและเตือนเท่านั้น
20. **ความผิดปกติที่ยอมรับได้**: สมมติว่าถ้า Daily Report ≥ ScanData ถือว่าปกติ แต่ถ้าต่างกันมาก (เช่น > 2 ชม.) จะแสดง Warning
21. **การมาสาย**: สมมติว่าสแกนนิ้วหลัง 08:00 น. ถือว่ามาสาย โดยนับจำนวนนาทีตั้งแต่ 08:00 น. เป็นต้นไป
22. **OT ข้ามวัน**: สมมติว่าถ้า OT เย็นข้ามวันที่ (เช่น เริ่ม 17:00 จบ 01:00) จะนับชั่วโมง OT จากเวลาเริ่มถึงเวลาจบได้

## Dependencies

### Database และ Authentication
- **Firebase Realtime Database** หรือ **Firestore**: สำหรับเก็บข้อมูล User, DC, Project Location, Daily Report, Edit History, Wage Period, DC Income/Expense Details, Additional Income/Expense Per Period, Social Security Calculation, ScanData, ScanData Discrepancy และ Late Record
- **Firebase Authentication**: สำหรับระบบ Login และการจัดการ User Authentication
- Firebase Configuration จะถูกเก็บใน Environment Variables เพื่อความปลอดภัย

### File Storage
- **Cloudflare R2 Object Storage**: สำหรับเก็บไฟล์ ภาพ และเอกสารที่เกี่ยวข้องกับระบบ
- Cloudflare R2 Configuration (API Keys, Bucket Names) จะถูกเก็บใน Environment Variables

### Technical Requirements
- ระบบต้องรองรับภาษาไทย (UTF-8 encoding) ในทุกส่วน
- ระบบต้องมี Environment Configuration Management สำหรับจัดการ credentials และ API keys
- ระบบต้องมี Authorization Rules สำหรับควบคุมการเข้าถึงข้อมูลตาม Role
- ระบบต้องมีความสามารถในการ Export ข้อมูลเป็นไฟล์ Excel (สำหรับสรุปค่าแรงประจำงวด)
- ระบบต้องมีความสามารถในการ Import ข้อมูลจากไฟล์ Excel (สำหรับ ScanData) โดยใช้ library เช่น SheetJS, xlsx, หรือ ExcelJS

## Out of Scope

- การสร้างรายงานสรุปค่าแรงรายเดือน (มีเฉพาะรายงานต่องวด 15 วัน)
- การ export ข้อมูลเป็น PDF (มีเฉพาะ Excel)
- การแจ้งเตือนผ่าน Email หรือ SMS
- Mobile application (scope นี้เป็น Web application เท่านั้น)
- การ integrate กับระบบบัญชีหรือระบบ Payroll อื่นๆ
- การจัดการเงินเดือนพนักงานประจำ (จัดการเฉพาะแรงงานรายวัน DC เท่านั้น)
