### User Story 7 - การคำนวณค่าแรงต่องวด (WageCaculation) (Priority: P7)

ในฐานะ Admin ฉันต้องการจัดเห็นสรุปการคำนวณค่าแรงที่ต้องจ่ายในแต่ละงวดโดย 1 งวดจะอยู่ในช่วง 15 วันเพื่อทำจ่ายให้กับ (DC - Daily Contractor) โดยสามารถ สร้างงวดตัดค่าแรง/แก้ไข/ลบ ได้ โดยภายในการสร้างงวดค่าแรงจะทำงานเพื่อกำหนดขอบเขตุการคำนวณ และให้ได้ผลลัพธ์ที่ User ต้องการ

**Why this priority**: เป็นฟังก์ชัน Master Data Management และ Calculate สำหรับคำนวณค่าแรงงานรายวัน จำเป็นและต้องทำอันดับแรก ๆ 

**Independent Test**: สามารถทดสอบได้โดยเข้าเมนู "WageCaculation", เพิ่ม/แก้ไข/ลบข้อมูลงวดตัดค่าแรงจากนั้นคำนวณพร้อมสรุป Export ออกมาเป็น Excel โดยประกอบด้วย Field : ลำดับ (runningNumber), EmployeeID, EmployeeName, Position, Skill, วันที่เริ่มต้นงวด, วันที่สิ้นสุดงวด, จำนวนชั่วโมงปกติรวมทั้งงวด, จำนวนชั่วโมงโอทีรวมทั้งงวด, ค่าแรงต่อชั่วโมง, ค่าวิชาชีพต่อชั่วโมง, ยอดรายได้อื่น ๆ ประจำงวด, ค่าโทรศัพธ์ต่องวด, ยอดรวมค่าแรงปกติ (จำนวนชั่วโมงปกติรวมทั้งงวด * ค่าแรงต่อชั่วโมง), ยอดรวมค่าแรงโอที (จำนวนชั่วโมงโอทีรวมทั้งงวด * ค่าแรงต่อชั่วโมง*1.5),ยอดรวมค่าวิชาชีพ (จำนวนชั่วโมงปกติรวมทั้งงวด * ค่าวิชาชีพต่อชั่วโมง), ค่าที่พักต่องวด, ค่าที่พักผู้ติดตามต่องวด, ค่าใช้ตู้เย็นต่องวด, ค่าใช้เครื่องเสียงต่องวด, ค่าใช้ทีวีต่องวด, ค่าใช้เครื่องซักผ้าต่องวด, ค่าใช้แอร์เคลื่อนที่ต่องวด, รายจ่ายอื่น ๆ ประจำงวด, ยอดประกันสังที่ควรจ่าย (คำนวณจาก ยอดรวมค่าแรงปกติ * 0.05), ยอดจ่ายประกันสังคมที่ชำระแล้วในเดือน (ยอดรวมค่าแรงปกติในเดือนเดียวกันกับวันเริ่มงวด * 0.05), ยอดจ่ายประกันสังคมประจำงวด (หากEmployeeID ขึ้นต้นด้วยเลข 9 เช่น 900001 ให้คืนค่า 0 แต่ถ้า if(ยอดประกันสังที่ควรจ่าย + ยอดจ่ายประกันสังคมที่ชำระแล้วในเดือน > 750 บาท, 750 - ยอดจ่ายประกันสังคมที่ชำระแล้วในเดือน , if(ยอดประกันสังที่ควรจ่าย > 83,ยอดประกันสังที่ควรจ่าย,83)), ยอดรวมรายได้ (คำนวณจากรายได้รวมทั้งหมด), ยอดรวมรายจ่าย (คำนวณจากรายจ่ายรวมทั้งหมด), ยอดสุทธิ (ยอดรวมรายได้ - ยอดรวมรายจ่าย)และหมายเหตุ 

**Acceptance Scenarios**:

1. **Given** ผู้ใช้ที่มีสิทธิ์เข้าเมนู WageCalculation, **When** คลิกเพิ่มงวดตัดค่าแรง, **Then** ระบบแสดง Popup ฟอร์มกรอกข้อมูล: วันที่เริ่มต้นงวด, วันที่สิ้นสุดงวด, โครงการ (ค่าตั้งต้น ตามสังกัดที่อยู่)
2. **Given** ผู้ใช้กรอกข้อมูลครบถ้วน, **When** กดเริ่มคำนวณ, **Then** ระบบทำการดึงข้อมูลจากฐานข้อมูลที่เกี่ยวข้องกับ ข้อมูล DC พวกรายละเอียดรายได้ และค่าใช้จ่ายแต่ละคน และ Daily Report ต่าง ๆ ที่อยู่ในช่วง วันที่เริ่มต้นและสิ้นสุดงวดและเห็นปุ่มในการเพิ่ม "รายจ่ายอื่น ๆ ประจำงวด" และ "ยอดรายได้อื่น ๆ ประจำงวด" คำนวณดังต่อไปนี้
      ลำดับ (runningNumber), EmployeeID, EmployeeName, Position, Skill, วันที่เริ่มต้นงวด, วันที่สิ้นสุดงวด, จำนวนชั่วโมงปกติรวมทั้งงวด, จำนวนชั่วโมงโอทีรวมทั้งงวด, ค่าแรงต่อชั่วโมง, ค่าวิชาชีพต่อชั่วโมง, ยอดรายได้อื่น ๆ ประจำงวด, ค่าโทรศัพธ์ต่องวด, ยอดรวมค่าแรงปกติ (จำนวนชั่วโมงปกติรวมทั้งงวด * ค่าแรงต่อชั่วโมง), ยอดรวมค่าแรงโอที (จำนวนชั่วโมงโอทีรวมทั้งงวด * ค่าแรงต่อชั่วโมง*1.5),ยอดรวมค่าวิชาชีพ (จำนวนชั่วโมงปกติรวมทั้งงวด * ค่าวิชาชีพต่อชั่วโมง), ค่าที่พักต่องวด, ค่าที่พักผู้ติดตามต่องวด, ค่าใช้ตู้เย็นต่องวด, ค่าใช้เครื่องเสียงต่องวด, ค่าใช้ทีวีต่องวด, ค่าใช้เครื่องซักผ้าต่องวด, ค่าใช้แอร์เคลื่อนที่ต่องวด, รายจ่ายอื่น ๆ ประจำงวด, ยอดประกันสังที่ควรจ่าย (คำนวณจาก ยอดรวมค่าแรงปกติ * 0.05), ยอดจ่ายประกันสังคมที่ชำระแล้วในเดือน (ยอดรวมค่าแรงปกติในเดือนเดียวกันกับวันเริ่มงวด * 0.05), ยอดจ่ายประกันสังคมประจำงวด (หากEmployeeID ขึ้นต้นด้วยเลข 9 เช่น 900001 ให้คืนค่า 0 แต่ถ้า if(ยอดประกันสังที่ควรจ่าย + ยอดจ่ายประกันสังคมที่ชำระแล้วในเดือน > 750 บาท, 750 - ยอดจ่ายประกันสังคมที่ชำระแล้วในเดือน , if(ยอดประกันสังที่ควรจ่าย > 83,ยอดประกันสังที่ควรจ่าย,83) ), ยอดรวมรายได้ (คำนวณจากรายได้รวมทั้งหมด), ยอดรวมรายจ่าย (คำนวณจากรายจ่ายรวมทั้งหมด), ยอดสุทธิ (ยอดรวมรายได้ - ยอดรวมรายจ่าย)และหมายเหตุ 
3. **Given** ผู้ใช้งานกรอกข้อมูล รายได้อื่น ๆ ประจำงวด, **When** ผู้ใช้เข้าหน้า WageCalculation และหลังจากกดปุ่มคำนวณ ที่รายชื่อแต่ละคนกดที่ปุ่ม "รายได้อื่น ๆ ประจำงวด", **Then** Popup สำหรับกรอกข้อมูลเกี่ยวกับรายได้ต่าง ๆ ในงวด ในรูปแบบตาราง แต่ละ row คือรายละเอียด 1 รายการ ประกอบด้วย Field : รายการ, จำนวนเงิน, หมายเหตุ และเมื่อกรอกข้อมูลที่ row สุดท้ายที่แสดง จะมี row ใหม่โผล่มาให้กรอกต่อเสมอ
4. **Given** ทำการบันทึก รายได้อื่น ๆ ประจำงวด , **When** หลังจากกรอกข้อมูลครบแล้ว กดปุ่มบันทึก, **Then** ระบบจัดเก็บข้อมูลลงฐานข้อมูลพนักงานว่าในงวดนี้มีกี่รายการ รายการละเท่าไร และคำนวณยอดรวม รายได้อื่น ๆ ประจำงวด ว่าเท่าไร เพื่อแสดงในตารางสรุปการคำนวณเป็นยอดดังกล่าว
5. **Given** ผู้ใช้งานกรอกข้อมูล รายจ่ายอื่น ๆ ประจำงวด, **When** ผู้ใช้เข้าหน้า WageCalculation และหลังจากกดปุ่มคำนวณ ที่รายชื่อแต่ละคนกดที่ปุ่ม "รายจ่ายอื่น ๆ ประจำงวด", **Then** Popup สำหรับกรอกข้อมูลเกี่ยวกับรายจ่ายต่าง ๆ ในงวด ในรูปแบบตาราง แต่ละ row คือรายละเอียด 1 รายการ ประกอบด้วย Field : รายการ, จำนวนเงิน, หมายเหตุ และเมื่อกรอกข้อมูลที่ row สุดท้ายที่แสดง จะมี row ใหม่โผล่มาให้กรอกต่อเสมอ
6. **Given** ทำการบันทึก รายจ่ายอื่น ๆ ประจำงวด , **When** หลังจากกรอกข้อมูลครบแล้ว กดปุ่มบันทึก, **Then** ระบบจัดเก็บข้อมูลลงฐานข้อมูลพนักงานว่าในงวดนี้มีกี่รายการ รายการละเท่าไร และคำนวณยอดรวม รายจ่ายอื่น ๆ ประจำงวด ว่าเท่าไร เพื่อแสดงในตารางสรุปการคำนวณเป็นยอดดังกล่าว
7. **Given** บันทึกเสร็จสิ้นการคำนวณ , **When** หลังจากตรวจสอบและลงข้อมูลครบ User กดปุ่ม บันทึกค่าแรงประจำงวด, **Then** ระบบจัดเก็บข้อมูลลงฐานข้อมูลว่าในแต่ละ Field ในงวดนี้เก็บอะไรไว้บ้างมีค่าเท่าไรบ้าง และต้องสามารถดึงข้อมูลถึงกัน เพื่ออ้างอิงได้ ดังนั้นต้อง Link Primary Key เข้ากับ รายได้อื่น ๆ ประจำงวด, รายจ่ายอื่น ๆ ประจำงวด ที่บันทึกไว้ใน Collection อื่น ๆ ด้วย


---


